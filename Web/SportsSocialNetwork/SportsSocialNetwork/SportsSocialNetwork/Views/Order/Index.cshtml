@model SportsSocialNetwork.Models.ViewModels.OrderViewModel

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_BookingFieldLayout.cshtml";
}

<div class="panel">
    <div class="panel-body">
        <h1>Lịch sử đặt sân</h1>
    </div>
</div>
<div class="panel">
    <div class="panel-body">
        <table class="table table-striped table-bordered table-hover" id="DataTables_Table_0">
            <thead>
                <tr>
                    <th>Tên sân</th>
                    <th>Thời gian đặt</th>
                    <th>Thời gian sử dụng</th>
                    <th></th>
                    <th></th>
                    <th>Hình thức thanh toán</th>
                    <th>Trạng thái</th>
                    <th>Chi tiết</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="orderDetail" aria-hidden="true"
     aria-labelledby="orderDetail" role="dialog" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div id="order-detail-modal-container"></div>
        </div>
    </div>
</div>




@section Scripts{

    <script>
        (function (document, window, $) {
            'use strict';

            var Site = window.Site;
            $(document).ready(function () {
                Site.run();
            });
        })(document, window, jQuery);

        function CancelOrder(id)
        {
            $.ajax({
                url: '@Url.Action("CancelOrder")',
                type: 'Get',
                data: {
                    id: id
                },
                success: function (data) {
                    if (data === "success") {
                        showMessage("Hủy đặt sân thành công.", "success", "OK");
                        RefreshTable();
                    } else {
                        showMessage("Có lỗi xảy ra. Vui lòng thử lại sau.", "error", "OK");
                    }
                },
                error: function (error) {
                    showMessage("Có lỗi xảy ra. Vui lòng thử lại sau.", "error", "OK");
                }
            });
        }

        function showDetailModal(id) {
            $.ajax({
                url: '@Url.Action("OrderDetail")',
                type: 'Get',
                data: { id: id },
                success: function (data) {
                    $('#order-detail-modal-container').html(data);
                    $('#orderDetail').modal('show');
                },
                error: function (error) {
                    showMessage("Có lỗi xảy ra. Vui lòng thử lại sau.", "error", "OK");
                }
            });
        }

        function RefreshTable() {
            var oTable = $("#DataTables_Table_0").dataTable();
            oTable._fnPageChange(0);
            oTable._fnAjaxUpdate();
        };

        function InitDatatable() {
            $("#DataTables_Table_0").DataTable({
                "bRetrieve": true,
                "bServerSide": true,
                "bScrollCollapse": true,
                "bSort": true,
                "sAjaxSource": "/Order/GetData",
                "bProcessing": true,
                "aLengthMenu": [10, 20, 50],
                "oLanguage": {
                    "sSearch": "Tìm kiếm:",
                    "sZeroRecords": "Không có dữ liệu phù hợp",
                    "sInfo": "Hiển thị từ _START_ đến _END_ trên tổng số _TOTAL_ dòng",
                    "sEmptyTable": "Không có dữ liệu",
                    "sInfoFiltered": " - lọc ra từ _MAX_ dòng",
                    "sLengthMenu": "Hiển thị _MENU_ dòng",
                    "sProcessing": "Đang xử lý...",
                    "oPaginate": {
                        "sPrevious": "Trang trước",
                        "sNext": "Trang kế"
                    }
                },

                "aoColumnDefs": [
                    {
                        "aTargets": [0],
                        "mRender": function (data, type, o) {
                            return o[1];
                        }
                    },
                    {
                        "aTargets": [1],
                        "bSortable": false,
                        "mRender": function (data, type, o) {
                            return o[2];
                        }
                    },
                    {
                        "aTargets": [2],
                        "bSortable": false,
                        "mRender": function (data, type, o) {
                            return o[3] +' - '+ o[5]+', Ngày '+ o[4];
                        }
                    },
                    {
                        "aTargets": [3, 4],
                        "bSortable": false,
                        "bVisible": false
                    },
                    {
                        "aTargets": [5],
                        "bSortable": false,
                        "mRender": function (data, type, o) {
                            if (o[6] == 0) {
                                return "<span class='label label-lg label-outline label-primary'>Online</span>";
                            } else if (o[6] == 1) {
                                return "<span class='label label-lg label-outline label-dark'>Tiền mặt</span>";
                            }
                        }
                    },
                    {
                        "aTargets": [6],
                        "bSortable": false,
                        "mRender": function (data, type, o) {
                            if (o[7] == 1) {
                                return "<span class='label label-lg label-outline label-warning'>Chưa thanh toán</span>";
                            } else if(o[7] == 2) {
                                return "<span class='label label-lg label-outline label-success'>Đã thanh toán</span>";
                            } else {
                                return "<span class='label label-lg label-outline label-danger'>Đã Hủy</span>";
                            }
                        }
                    },
                    {
                        "aTargets": [7],
                        "bSortable": false,
                        "mRender": function (data, type, o) {
                            return "<button class='btn btn-primary' onclick='showDetailModal(" + o[0] + ")' data-target='#orderDetail' data-toggle='modal' type='button'><i class='icon wb-pencil' aria-hidden='true'></i></button>";
                        }
                    }

                ],

            });
        };

        $(document).ready(function () {
            InitDatatable();
            RefreshTable();
            //loadlist();
        });

    </script>

}

