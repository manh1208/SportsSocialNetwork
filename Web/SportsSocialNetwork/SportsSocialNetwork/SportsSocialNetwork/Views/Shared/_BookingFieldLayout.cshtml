@using Microsoft.AspNet.Identity;
@using SportsSocialNetwork.Models.Enumerable;
@{
    Layout = null;
}
<!DOCTYPE html>
<html class="no-js before-run" lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta name="description" content="bootstrap admin template">
    <meta name="author" content="">

    <title>SSN</title>

    <link rel="apple-touch-icon" href="~/Content/assets/images/apple-touch-icon.png">
    <link rel="shortcut icon" href="~/Content/images/logo_new.png">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="~/Content/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/Content/assets/css/bootstrap-extend.min.css">
    <link rel="stylesheet" href="~/Content/assets/css/site.min.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/bootstrap-datepicker/bootstrap-datepicker.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/bootstrap-touchspin/bootstrap-touchspin.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/clockpicker/clockpicker.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/animsition/animsition.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/asscrollable/asScrollable.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/switchery/switchery.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/intro-js/introjs.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/slidepanel/slidePanel.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/flag-icon-css/flag-icon.css">
    <link rel="stylesheet" type="text/css" href="~/Content/assets/vendor/datatables/datatables.css">
    <link rel="stylesheet" type="text/css" href="~/Content/assets/slick/slick.css" />
    <link rel="stylesheet" type="text/css" href="~/Content/assets/slick/slick-theme.css" />
    <!-- Plugin -->
    <link rel="stylesheet" href="~/Content/assets/vendor/chartist-js/chartist.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/jvectormap/jquery-jvectormap.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/owl-carousel/owl.carousel.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/slick-carousel/slick.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/formvalidation/formValidation.css">
    <!-- Page -->
    <link rel="stylesheet" href="~/Content/assets/css/../fonts/weather-icons/weather-icons.css">
    <link rel="stylesheet" href="~/Content/assets/css/dashboard/v1.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/jquery-selective/jquery-selective.css">

    <!-- Fonts -->
    <link rel="stylesheet" href="~/Content/assets/fonts/web-icons/web-icons.min.css">
    <link rel="stylesheet" href="~/Content/assets/fonts/brand-icons/brand-icons.min.css">
    <link rel="stylesheet" href="~/Content/font-awesome-4.6.3/css/font-awesome.min.css">

    <!--DataTable-->
    <link rel="stylesheet" href="~/Content/assets/vendor/datatables-bootstrap/dataTables.bootstrap.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/datatables-fixedheader/dataTables.fixedHeader.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/datatables-responsive/dataTables.responsive.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/magnific-popup/magnific-popup.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/bootstrap-tagsinput/bootstrap-tagsinput.css">
    <link rel="stylesheet" href="~/Content/assets/css/apps/calendar.css">
    <link rel="stylesheet" href="~/Content/assets/vendor/fullcalendar/fullcalendar.css">
    <link href="~/Content/js/sweetAlert/sweetalert.css" rel="stylesheet" />
    <link href="~/Content/css/all.min.css" rel="stylesheet" />
    <link href="~/Content/Site.css" rel="stylesheet" />
    <!--[if lt IE 9]>
      <script src="~/Content/assets/vendor/html5shiv/html5shiv.min.js"></script>
      <![endif]-->
    <!--[if lt IE 10]>
      <script src="~/Content/assets/vendor/media-match/media.match.min.js"></script>
      <script src="~/Content/assets/vendor/respond/respond.min.js"></script>
      <![endif]-->
    <!-- Scripts -->
    <script src="~/Content/assets/vendor/modernizr/modernizr.js"></script>
    <script src="~/Content/assets/vendor/jquery/jquery.js"></script>
    <script src="~/Content/assets/vendor/breakpoints/breakpoints.js"></script>
    <script src="http://maps.google.com/maps/api/js?key=AIzaSyCkOH4-62T51e6We4RRmXofijgUEgQf64c">
    </script>
    <script type="text/javascript" src="~/Content/assets/slick/slick.min.js"></script>
    <script>
        Breakpoints();
    </script>
    <style>
        .logo-link {
            color: #fff;
        }

            .logo-link a span {
                color: #fff;
            }

            .logo-link a {
                text-decoration: none;
            }
    </style>
    <style>
        body {
            background-color: #f5f5f5;
            color: #000000;
        }

        .page {
            margin-right: 260px;
        }

        .page-content {
            padding: 10px 0 0 0;
        }

        .user-search:hover {
            background-color: #62a8ea;
        }
        .navbar-brand {
            float: left;
            padding:20px 20px;
        }

        .active-menu {
            color: #ff6a00 !important;
            border-bottom-style: solid ;
            border-bottom-width:3px;
        }
    </style>
    @RenderSection("styles", false)
</head>
<body class="dashboard">
    <!--[if lt IE 8]>
          <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
      <![endif]-->

    <nav class="site-navbar navbar navbar-default navbar-fixed-top navbar-mega" style="padding:0 5%" role="navigation">

        <div class="navbar-header" style="background-color:#ffffff; width:72px">

            @if (User != null && User.Identity.IsAuthenticated)
            {
                <a href="@Url.Action("Index", "SSN", new { area = "" })">
                    <div class="navbar-brand navbar-brand-center site-gridmenu-toggle logo-link">

                        <img class="navbar-brand-logo" src="~/Content/images/logo_new.png" title="Sports" />


                    </div>
                </a>
            }
            else
            {
                <a href="@Url.Action("Index", "News", new { area = "" })">
                    <div class="navbar-brand navbar-brand-center site-gridmenu-toggle logo-link">

                        <img class="navbar-brand-logo" src="~/Content/images/logo_new.png" title="Sports" />

                    </div>
                </a>
            }
        </div>

        <div class="navbar-container container-fluid" style="margin-left:72px">
            <!-- Navbar Collapse -->
            <div class="collapse navbar-collapse navbar-collapse-toolbar" id="site-navbar-collapse">
                <!-- Navbar Toolbar -->
                <!-- End Navbar Toolbar -->
                <!-- Navbar Toolbar Right -->
                <ul class="nav navbar-toolbar navbar-right navbar-toolbar-right">
                    @if (User != null && User.Identity.IsAuthenticated)
                    {
                        <li class="dropdown">
                            <a href="@Url.Action("Index","SSN",new { area = "" })" aria-expanded="false"
                               style="color:#263238; font-weight:500;font-size:medium; margin-top:15px; margin-bottom:15px; padding-top:5px; padding-bottom:5px"
                               role="button"
                               id="menu-home">Trang chủ</a>
                        </li>
                    }
                    <li class="dropdown">
                        <a href="@Url.Action("Index","News",new { area = "" })" aria-expanded="false"
                           style="color:#263238; font-weight:500;font-size:medium ; margin-top:15px; margin-bottom:15px; padding-top:5px; padding-bottom:5px"
                           role="button"
                           id="menu-news">Tin tức</a>

                    </li>
                    @if (User != null && User.Identity.IsAuthenticated)
                    {
                        <li class="dropdown">
                            <a data-toggle="dropdown" href="javascript:void(0)" title="Notifications" aria-expanded="false" style="color:#263238; font-weight:500;font-size:medium"
                               data-animation="slide-bottom" role="button">
                                <i class="icon wb-bell" aria-hidden="true" id="notibell"></i>
                                @*<span class="badge badge-danger up" id="notiCount"></span>*@
                            </a>
                            <ul class="dropdown-menu dropdown-menu-right dropdown-menu-media" role="menu" id="listNoti">
                                <li class="dropdown-menu-header" role="presentation" id="headNoti" style="padding: 10px 20px;background-color: #ffefdf;">
                                    <h5 id="notiTitle" style="color: #000000!important;font-weight: 500;font-size: medium;">THÔNG BÁO</h5>
                                    @*<span class="label label-round label-danger" id="notiLabelCount"></span>*@
                                </li>


                                <li class="list-group notiDiv" role="presentation" style="max-height:400px;">
                                    <div data-role="container" style="height:400px;" class="notiDiv">
                                        <div data-role="content" id="notiItems" class="notiDiv">
                                            @*<a class="list-group-item" href="javascript:void(0)" role="menuitem">
                                                    <div class="media">
                                                        <div class="media-left padding-right-10">
                                                            <i class="icon wb-order bg-red-600 white icon-circle" aria-hidden="true"></i>
                                                        </div>
                                                        <div class="media-body">
                                                            <h6 class="media-heading">A new order has been placed</h6>
                                                            <time class="media-meta" datetime="2015-06-12T20:50:48+08:00">5 hours ago</time>
                                                        </div>
                                                    </div>
                                                </a>*@
                                        </div>
                                    </div>
                                </li>
                                <li class="dropdown-menu-footer" role="presentation" id="notiBottom">
                                    <a class="dropdown-menu-footer-btn" href="javascript:void(0)" role="button" onclick="markAllAsRead()"
                                       style="color:#000!important; font-weight:400">
                                        <i class="icon wb-check-circle" aria-hidden="true"></i>Đánh dấu xem tất cả
                                    </a>
                                    <a href="@Url.Action("Index", "Notification")" role="menuitem"
                                       style="color:#000!important; font-weight:400">
                                        Xem tất cả thông báo
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a class="navbar-avatar dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false"
                               data-animation="slide-bottom" role="button">
                                <span id="ava" class="avatar avatar-online">
                                </span>
                            </a>
                            <ul class="dropdown-menu width-250" role="menu">
                                <li role="presentation">
                                    <form action="@Url.Action("Index","SSN", new { area = "" })" style="margin:10px" method="post" id="form-home-page">
                                        <a href="#" role="menuitem" onclick="homePage()"
                                           style="color:#54616E;font-weight:500">
                                            <span class="fa fa-globe"></span>&nbsp; Trang chủ
                                        </a>
                                    </form>
                                </li>
                                <li role="presentation">
                                    <form action="" style="margin:10px" method="post" id="form-">
                                        <a href="#" role="menuitem" onclick="" style="color:#54616E;font-weight:500">
                                            <span class="fa fa-key"></span>&nbsp; Đổi mật khẩu
                                        </a>
                                    </form>
                                </li>
                                <li role="presentation">
                                    <form action="@Url.Action("Index","UserInvitation", new { area = "" })" style="margin:10px" method="post" id="form-invite-player">
                                        <a href="#" role="menuitem" onclick="invitePlayer()" style="color:#54616E;font-weight:500">
                                            <span class="fa fa-pencil-square-o"></span>&nbsp; Mời chơi thể thao
                                        </a>
                                    </form>
                                </li>
                                <li role="presentation">
                                    <form action="@Url.Action("Index","Invitation", new { area = "" })" style="margin:10px" method="post" id="form-invite-history">
                                        <a href="#" role="menuitem" onclick="inviteHistory()" style="color:#54616E;font-weight:500">
                                            <span class="fa fa-users"></span>&nbsp; Lịch sử mời chơi thể thao
                                        </a>
                                    </form>
                                </li>
                                <li role="presentation">
                                    <form action="@Url.Action("Index","Event", new { area = "" })" style="margin:10px" method="post" id="form-search-event">
                                        <a href="#" role="menuitem" onclick="searchEvent()" style="color:#54616E;font-weight:500">
                                            <span class="fa fa-bullhorn"></span>&nbsp; Các sự kiện thể thao
                                        </a>
                                    </form>
                                </li>
                                <li role="presentation">
                                    <form action="@Url.Action("Index","Place", new { area = "" })" style="margin:10px" method="post" id="form-search-place">
                                        <a href="#" role="menuitem" onclick="searchPlace()" style="color:#54616E;font-weight:500">
                                            <span class="fa fa-futbol-o"></span>&nbsp; Tìm nơi chơi thể thao
                                        </a>
                                    </form>
                                </li>
                                <li role="presentation">
                                    <form action="@Url.Action("Index","Order", new { area = "" })" style="margin:10px" method="post" id="form-order-history">
                                        <a href="#" role="menuitem" onclick="orderHistory()" style="color:#54616E;font-weight:500">
                                            <span class="fa fa-history"></span>&nbsp; Lịch sử đặt sân
                                        </a>
                                    </form>
                                </li>
                                <li role="presentation">
                                    <form action="@Url.Action("LogOff","Account", new { area = "" })" style="margin:10px" method="post" id="form-log-out">
                                        @Html.AntiForgeryToken()
                                        <a href="#" role="menuitem" onclick="logout()" style="color:#54616E;font-weight:500">
                                            <span class="fa fa-sign-out"></span>&nbsp; Đăng xuất
                                        </a>
                                    </form>
                                </li>
                            </ul>
                        </li>
                    }
                    else
                    {
                        <li class="dropdown">
                            <a href="@Url.Action("Login","Account",new { area = "" })" aria-expanded="false"
                               style="color:#263238; font-weight:500;font-size:medium ; margin-top:15px; margin-bottom:15px; padding-top:5px; padding-bottom:5px"
                               role="button">Vào mạng xã hội</a>

                        </li>
                    }

                </ul>
                <!-- End Navbar Toolbar Right -->
            </div>
            <!-- End Navbar Collapse -->
            @if (User != null && User.Identity.IsAuthenticated)
            {
            <!-- Site Navbar Seach -->
                <div class="navbar-search-overlap col-md-6" style="padding:0; margin-top:15px;" id="site-navbar-search">
                    <form role="search" autocomplete="off">
                        <div class="form-group">
                            <div class="input-search" style="border:groove 1px;border-radius:5px;">
                                <i class="input-search-icon wb-search" aria-hidden="true"></i>
                                <input type="text" id="search-input" style="height:36px!important; border-radius:5px" class="form-control" name="site-search" placeholder="Tìm kiếm người hoặc nhóm...">

                            </div>
                        </div>
                        <div id="showSearch" style="width:100%;height:auto;display:none;border: 0.5px groove;">

                        </div>
                    </form>
                </div>
            <!-- End Site Navbar Seach -->
            }
        </div>
    </nav>

    <!-- Page -->
    <div style="padding-left:3%; padding-right:3%; background-color:whitesmoke; min-height:100%; font-size:1.2em">
        <div class="page-content padding-30 container-fluid">
            @RenderBody()
        </div>
    </div>
    <!-- End Page -->
    <!-- Core  -->
    <footer class="site-footer" style="margin-left:0">
        <span class="site-footer-legal">© 2016 SSN - Capstone Project</span>
        <div class="site-footer-right">

        </div>
    </footer>

    <script src="~/Content/assets/vendor/bootstrap/bootstrap.js"></script>
    <script src="~/Content/assets/vendor/animsition/jquery.animsition.js"></script>
    <script src="~/Content/assets/vendor/asscroll/jquery-asScroll.js"></script>
    <script src="~/Content/assets/vendor/mousewheel/jquery.mousewheel.js"></script>
    <script src="~/Content/assets/vendor/asscrollable/jquery.asScrollable.all.js"></script>
    <script src="~/Content/assets/vendor/ashoverscroll/jquery-asHoverScroll.js"></script>

    <!-- Plugins -->
    <script src="~/Content/assets/vendor/switchery/switchery.min.js"></script>
    <script src="~/Content/assets/vendor/intro-js/intro.js"></script>
    <script src="~/Content/assets/vendor/screenfull/screenfull.js"></script>
    <script src="~/Content/assets/vendor/slidepanel/jquery-slidePanel.js"></script>

    <script src="~/Content/assets/vendor/datatables/jquery.dataTables.min.js"></script>
    <script src="~/Content/assets/vendor/datatables-fixedheader/dataTables.fixedHeader.js"></script>
    <script src="~/Content/assets/vendor/datatables-bootstrap/dataTables.bootstrap.js"></script>
    <script src="~/Content/assets/vendor/datatables-responsive/dataTables.responsive.js"></script>
    <script src="~/Content/assets/vendor/datatables-tabletools/dataTables.tableTools.js"></script>

    <script src="~/Content/assets/vendor/skycons/skycons.js"></script>
    <script src="~/Content/assets/vendor/chartist-js/chartist.min.js"></script>
    <script src="~/Content/assets/vendor/aspieprogress/jquery-asPieProgress.min.js"></script>
    <script src="~/Content/assets/vendor/jvectormap/jquery-jvectormap.min.js"></script>
    <script src="~/Content/assets/vendor/jvectormap/maps/jquery-jvectormap-ca-lcc-en.js"></script>
    <script src="~/Content/assets/vendor/matchheight/jquery.matchHeight-min.js"></script>
    <script src="~/Content/assets/vendor/owl-carousel/owl.carousel.js"></script>
    <script src="~/Content/assets/vendor/slick-carousel/slick.js"></script>

    <!-- Scripts -->
    <script src="~/Content/assets/js/core.js"></script>
    <script src="~/Content/assets/js/site.js"></script>
    <script src="~/Content/assets/vendor/formvalidation/formValidation.min.js"></script>
    <script src="~/Content/assets/vendor/formvalidation/framework/bootstrap.min.js"></script>
    <script src="~/Content/assets/js/sections/menu.js"></script>
    <script src="~/Content/assets/js/sections/menubar.js"></script>
    <script src="~/Content/assets/js/sections/sidebar.js"></script>

    <script src="~/Content/assets/js/configs/config-colors.js"></script>
    <script src="~/Content/assets/js/configs/config-tour.js"></script>
    <script src="~/Content/js/shieldui-all.min.js"></script>
    <script src="~/Content/assets/js/components/asscrollable.js"></script>
    <script src="~/Content/assets/js/components/animsition.js"></script>
    <script src="~/Content/assets/js/components/slidepanel.min.js"></script>
    <script src="~/Content/assets/js/components/switchery.js"></script>
    <script src="~/Content/assets/js/components/matchheight.js"></script>
    <script src="~/Content/assets/js/components/jvectormap.min.js"></script>
    <script src="~/Content/assets/js/components/owl-carousel.js"></script>
    <script src="~/Content/assets/js/components/datatables.js"></script>
    <script src="~/Content/assets/vendor/clockpicker/bootstrap-clockpicker.min.js"></script>
    <script src="~/Content/assets/js/components/clockpicker.js"></script>
    <script src="~/Content/assets/vendor/bootstrap-datepicker/bootstrap-datepicker.js"></script>
    <script src="~/Content/assets/js/components/bootstrap-datepicker.js"></script>
    <script src="~/Content/Bootbox/bootbox.min.js"></script>
    <script src="~/Content/assets/vendor/magnific-popup/jquery.magnific-popup.js"></script>
    <script src="~/Content/assets/js/components/material.min.js"></script>
    <script src="~/Content/assets/vendor/bootstrap-tagsinput/bootstrap-tagsinput.min.js"></script>
    <script src="~/Content/assets/js/components/bootstrap-tagsinput.js"></script>
    <script src="~/Content/assets/vendor/typeahead-js/bloodhound.min.js"></script>
    <script src="~/Content/assets/vendor/moment/moment.min.js"></script>
    <script src="~/Content/assets/vendor/fullcalendar/fullcalendar.js"></script>
    <script src="~/Content/assets/vendor/bootstrap-touchspin/jquery.bootstrap-touchspin.min.js"></script>
    <script src="~/Content/assets/js/components/bootstrap-touchspin.js"></script>
    <script src="~/Content/assets/vendor/jquery-selective/jquery-selective.min.js"></script>
    <script src="~/Content/assets/js/apps/app.js"></script>
    <script src="~/Content/js/custom-script.js"></script>
    <script src="~/Content/js/sweetAlert/sweetalert.min.js"></script>
    <script src="~/Content/assets/vendor/fullcalendar/lang-all.js"></script>
    <!--Signalr-->
    <script src="~/Scripts/jquery.signalR-2.2.1.min.js"></script>
    <script src="~/signalr/hubs"></script>
    <script>
        'use strict';

        var Site = window.Site;
            $(document).ready(function () {
                //Site.run();
                loadAvatar();
                $("#showSearch").hide();


                $("body").click(function (e) {
                    if (e.target.id !== 'site-navbar-search') {
                        $("#showSearch").hide();
                    }
                });
                $("#search-input").focus(function () {
                    $("#showSearch").show();
                })

                checkActive();
            });
    </script>
    <script>
        function checkActive() {
            var title = "@ViewBag.Type";
            if (title == "news") {
                $("#menu-home").removeClass("active-menu");
                $("#menu-news").addClass("active-menu");
            } else {
                $("#menu-home").addClass("active-menu");
                $("#menu-news").removeClass("active-menu");
            }
        }
        function loadAvatar() {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetAvatarImage", "SSN")',
                async: false,
                success: function (result) {
                    if (result.Succeed) {
                        $("#ava").empty();
                        if (result.AdditionalData != null) {
                            $("#ava").append('<img src="' + result.AdditionalData + '" style="height:30px;width:30px"><i></i>');
                        }
                    }
                }
            });
        }

        var totalUnreadCount = 0;
        var _notiFirstSkip = 0;
        var _notiFirstTake = 10;
        var _notiSkip = 10;
        var _notiTake = 5;

        function logout() {
            $("#form-log-out").submit();
        }
        function searchPlace() {
            $("#form-search-place").submit();
        }
        function orderHistory() {
            $("#form-order-history").submit();
        }
        function searchEvent() {
            $("#form-search-event").submit();
        }
        function invitePlayer() {
            $("#form-invite-player").submit();
        }
        function inviteHistory() {
            $("#form-invite-history").submit();
        }
        function homePage() {
            $("#form-home-page").submit();
        }
        var hasUser = false;
        var hasGroup = false;
        $("#search-input").on("keyup", function () {
            var keyword = $("#search-input").val();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetSearchUserResult", "SSN")',
                async: false,
                data: { "keyword": keyword, "skip": 0, "take": 5 },
                success: function (result) {
                    if (result.Succeed) {
                        $("#showSearch").empty();
                        if (result.AdditionalData != null) {
                            showSearchUser(result.AdditionalData);
                            $("#showSearch").show();
                            hasUser = true;
                        }
                    }
                }
            });
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetSearchGroupList", "SSN")',
                async: false,
                data: { "keyword": keyword, "skip": 0, "take": 2 },
                success: function (result) {
                    if (result.Succeed) {
                        if (result.AdditionalData != null) {
                            showSearchGroup(result.AdditionalData);
                            $("#showSearch").show();
                            hasGroup = true;
                        }

                    }
                }
            });
            if (hasGroup || hasUser) {
                $("#showSearch").append("<div tabindex='0' style='padding:10px' class='comment media user-search'><a href='/SSN/SearchDetail?keyword="+keyword+"'>"
                    + "<i class='icon wb-search' aria-hidden='true'></i> Xem toàn bộ kết quả</a></div>");
            }
        });

        function showSearchUser(data) {
            $("#showSearch").append("<div style='background-color:#ffefdf;margin-bottom:5px' tabindex='0' class='padding-left-10'>Cá nhân</div>");
            $(data.userList).each(function () {
                var hobby = "";
                if (this.sameSport != 0 && this.Id!= '@User.Identity.GetUserId()') {
                    hobby = "<span class='comment-content'><p>Có chung " + this.sameSport
                        + " sở thích</p></span>";
                }
                var info = "<div tabindex='0' style='padding:0 0 0 10px' class='comment media user-search'><a href='/profile/index?userid="+this.Id+"'>"
                + "<span class='media-left'>"
                + "<span class='avatar avatar-lg'>"
                + "<img style='height:50px;width:50px' src='" + this.AvatarImage + "'>"
                + "</span></span>"
                + "<span class='comment-body media-body'>"
                + "<span class='comment-author'>" + this.FullName + "</span>"
                + hobby + "</span></a></div>";
                $("#showSearch").append(info);

            });

        }

        function showSearchGroup(data) {
            $("#showSearch").append("<div style='background-color:#ffefdf;margin-bottom:5px' tabindex='0' class='padding-left-10'>Hội nhóm</div>");
            $(data.listGroup).each(function () {
                var info = "<div tabindex='0' style='padding:0 0 0 10px' class='comment media user-search'><a href='/Group/Index/"+this.Id+"'>"
                + "<span class='media-left'>"
                + "<span class='avatar avatar-lg'>"
                + "<img style='height:50px;width:50px' src='" + this.Avatar + "'>"
                + "</span></span>"
                + "<span class='comment-body media-body'>"
                + "<span class='comment-author'>" + this.Name + "</span>"
                + "<span class='comment-content'><p>Nhóm " + this.sport.Name
                        + " </p></span>" + "</span></a></div>";
                $("#showSearch").append(info);

            });

        }

    </script>

    <script type="text/javascript">
        $(function signalr() {
            // Declare a proxy to reference the hub.
            var commenthub = $.connection.realTimeHub;
            // Create a function that the hub can call to broadcast messages.
            commenthub.client.send = function (c) {
                //process

                appendNoti(c);

            };
            // Start the connection.
            $.connection.hub.start();
        });

        $(document).ready(function () {
            //Load Noti Count
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetUnreadCount", "Notification")',
                data: { "userId": '@User.Identity.GetUserId()' },
                success: function (result) {
                    if (result != "") {
                        totalUnreadCount = parseInt(result);
                        if (totalUnreadCount != 0) {
                            showPopNoti(totalUnreadCount);
                        }
                    }
                }

            });

            //Load Noti List
            @*$.ajax({
                type: 'POST',
                url: '@Url.Action("LoadNoti", "Notification")',
                data: { "userId": '@User.Identity.GetUserId()', "skip": _notiFirstSkip , "take": _notiFirstTake },
                success: function (result) {
                    var data = result.Data;

                    $(data).each(function () {
                        var noti = renderNoti(this);
                        $("#notiItems").append(noti);

                    })
                }

            });*@
            loadNoti(_notiFirstSkip, _notiFirstTake);
        })

        function appendNoti(data) {
            var noti = renderNoti(data);
            totalUnreadCount++;
            $("#notiItems").prepend(noti);
            if (totalUnreadCount != 0) {
                showPopNoti(totalUnreadCount);
            }
        }

        function renderNoti(data) {
            var image = "";
            var url = "";
            var colorUnread = "";

            if (data.MarkRead == false) {
                styleUnread = "background-color:#f1f0f0;";
            } else {
                styleUnread = "";
            }


            if (data.Type == parseInt('@((int)NotificationType.Post)')) {
                image = data.AspNetUser1.AvatarImage;
                url = "/SSN/PostDetail?postId=" + data.PostId;
            } else if (data.Type == parseInt('@((int)NotificationType.Order)')) {
                image = "/Content/images/flag-xxl.png";
                url = "/Order";
            } else if (data.Type == parseInt('@((int)NotificationType.Invitation)')) {
                image = data.AspNetUser1.AvatarImage;
                url = "/Invitation";
            } else if (data.Type == parseInt('@((int)NotificationType.GroupInvitation)')) {
                image = data.AspNetUser1.AvatarImage;
                url = "/Group/Index/" + data.Group.Id;
            } else if (data.Type == parseInt('@((int)NotificationType.GroupChallengeInvitation)')) {
                image = data.Group.Avatar;
                url = "/Group/Index/" + data.Group.Id;
            } else if (data.Type == parseInt('@((int)NotificationType.GroupMemberAction)')) {
                image = data.AspNetUser1.AvatarImage;
                url = "/Group/Index/" + data.Group.Id;
            } else if (data.Type == parseInt('@((int)NotificationType.GroupPost)')) {
                image = data.AspNetUser1.AvatarImage;
                url = "/Group/Index/" + data.Group.Id;
            } else {

            }


            //var noti = '<a class="list-group-item" href="' + url + '" role="menuitem" style="padding: 10px 15px;border-bottom-style: solid;border-bottom-color: #7c7b7b;' + styleUnread + '" onclick="markAsRead(' + data.Id + ')">' +
            //           '<div class="row height-100">' +
            //                '<div class="col-sm-2 vertical-align" style="padding-top:5px; padding-left:10px;">' +
            //                    '<span class="avatar" style="width:30px;">' +
            //                        '<img class="vertical-align-middle" src="' + image + '" width="60px" height="60px" />' +
            //                    '</span>' +
            //                '</div>' +
            //                '<div class="col-sm-9 height-100" style="padding-top:10px;">' +
            //                    '<h4 class="list-group-item-heading">' + data.Message + '</h4>' +
            //                    '<p class="list-group-item-text">' + data.CreateDateString + '</p>' +
            //                '</div>' +
            //            '</div>' +
            //        '</a>';
            var noti = '<a class="list-group-item" href="' + url + '" role="menuitem" style="' + styleUnread + '" onclick="markAsRead(' + data.Id + ')">' +
                      '<div class="media">' +
                        '<div class="media-left padding-right-10">' +
                          '<span class="avatar avatar-sm avatar-online">' +
                            '<img src="' + image + '" alt="...">' +

                          '</span>' +
                        '</div>' +
                        '<div class="media-body">' +

                          '<div class="media-detail" style="color:#000!important; font-weight:400;font-size:14px">' + data.Message + '</div>' +
                          '<div class="media-meta">' +
                            '<time datetime="">' + data.CreateDateString + '</time>' +
                          '</div>' +
                        '</div>' +
                      '</div>' +
                      '</a>';
            return noti;
        }

        function markAsRead(id) {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("MarkAsRead", "Notification")',
                data: { "id": id },
                success: function (result) {
                    if (result.Succeed) {

                    } else {
                        showMessage("Có lỗi xảy ra. Vui lòng thử lại sau.", "error", "OK");
                    }
                }
            })
        };


        function markAllAsRead(id) {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("MarkAllAsRead", "Notification")',
                data: { "userId": '@User.Identity.GetUserId()' },
                success: function (result) {
                    if (result.Succeed) {
                        $("#notiItems").find("a").css("background-color", "");
                        $("#notiCount").remove();
                        $("#notiLabelCount").remove();
                    } else {
                        showMessage("Có lỗi xảy ra. Vui lòng thử lại sau.", "error", "OK");
                    }
                }
            })
        };

        function showPopNoti(count) {
            if ($("#notiCount").length) {
                $("#notiCount").text(count);
            }
            else {
                var lable = '<span class="badge badge-danger up" id="notiCount">' + count + '</span>'
                $(lable).insertAfter("#notibell");
            }

            if ($("#notiLabelCount").length) {
                $("#notiLabelCount").text(count);
            }
            else {
                var titleCount = '<span class="label label-round label-danger" id="notiLabelCount">' + count + '</span>';
                $(titleCount).insertAfter("#notiTitle");
            }
        };

        function loadNoti(skip, take) {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("LoadNoti", "Notification")',
                data: { "userId": '@User.Identity.GetUserId()', "skip": skip, "take": take },
                success: function (result) {
                    var data = result.Data;

                    $(data).each(function () {
                        var noti = renderNoti(this);
                        $("#notiItems").append(noti);

                    })
                }

            });
        };

        $(".notiDiv").scroll(function () {
            if ($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight) {
                loadNoti(_notiSkip, _notiTake);
                _notiSkip = _notiSkip + _notiTake;
            }
        });
    </script>
    @RenderSection("Scripts", false)
</body>


</html>
